# FLIR ResearchIR 批量帧数据导出工具 v2.0

## 简介

这是一个用于自动化批量导出FLIR ResearchIR 4软件中帧数据的AutoHotkey脚本工具。由于FLIR ResearchIR软件本身不提供批量导出功能，需要手动一帧一帧地保存数据，这个工具可以自动化这个重复的过程。

## v2.0 新特性 ⭐

- **图像识别技术**：无需手动配置坐标，使用图像识别自动查找按钮
- **快捷键操作**：保存对话框使用快捷键操作，更稳定可靠
- **更强适应性**：适应不同分辨率和窗口位置
- **简化配置**：只需截取两张按钮图片即可

## 功能特点

- 自动化批量导出指定范围的帧数据
- 支持导出为CSV格式（X和Y值）
- 可自定义帧范围（起始帧和结束帧）
- 可自定义保存路径
- **使用图像识别，无需配置坐标**
- **使用快捷键操作保存对话框**
- 实时进度显示
- 支持中途取消（ESC键）

## 文件说明

- `FLIR_AutoSave.ahk` - 主脚本，执行批量导出任务（v2.0使用图像识别）
- `ImageCapture.ahk` - 图像截取辅助工具（新增）
- `CoordinateFinder.ahk` - 坐标获取工具（v1.x版本使用，v2.0不再需要）
- `save.png` - Save按钮截图（需要用户自行截取）
- `next.png` - 下一帧箭头按钮截图（需要用户自行截取）
- `1.jpg`, `2.jpg`, `3.jpg` - 操作流程截图参考
- `README.md` - 本说明文档

## 系统要求

- Windows操作系统
- FLIR ResearchIR 4软件
- AutoHotkey v1.1或更高版本（[下载地址](https://www.autohotkey.com/)）

## 安装步骤

1. 下载并安装AutoHotkey：https://www.autohotkey.com/
2. 下载本项目的所有文件到同一文件夹

## 使用步骤

### 第一步：截取按钮图像

使用Windows截图工具截取两个按钮的图像：

**方法一：使用Windows截图工具（推荐）**

1. 打开FLIR ResearchIR软件和Profile窗口
2. 按 `Win+Shift+S` 打开Windows截图工具（Windows 10/11）
3. 选择矩形截图模式

4. **截取Save按钮**：
   - 精确框选Profile窗口右上角的"Save"按钮
   - 打开画图（按Win+R，输入mspaint，回车）
   - 按Ctrl+V粘贴
   - 文件 → 另存为 → PNG图片
   - 文件名输入：`save.png`
   - 保存到脚本所在文件夹

5. **截取下一帧箭头**：
   - 按 `Win+Shift+S` 重新打开截图工具
   - 框选底部时间轴的"下一帧"右箭头按钮
   - 打开画图，粘贴
   - 保存为 `next.png`（保存到脚本所在文件夹）

**方法二：使用ImageCapture工具**

1. 双击运行 `ImageCapture.ahk`
2. 按照界面提示操作
3. 使用工具提供的说明截取图像

**截图技巧**：
- 截图时确保按钮处于正常状态（非高亮/按下状态）
- 尽量精确框选，只包含按钮本身
- 图像大小建议在30-80像素之间
- 确保图像清晰

### 第二步：配置脚本参数

1. 右键点击 `FLIR_AutoSave.ahk`，选择"Edit Script"（编辑脚本）
2. 找到"配置参数"部分，修改以下设置：

   ```ahk
   ; 帧范围设置
   StartFrame := 1          ; 起始帧号（改为你需要的起始帧）
   EndFrame := 100          ; 结束帧号（改为你需要的结束帧）

   ; 保存路径设置
   SavePath := "C:\FLIR_Export"  ; CSV文件保存目录（改为你的保存路径）
   ```

3. （可选）调整图像识别容差：
   ```ahk
   ImageTolerance := 30     ; 如果识别失败，可以适当增大（0-255）
   ```

4. 保存脚本（Ctrl+S）

### 第三步：运行批量导出

1. 确保FLIR ResearchIR软件已打开
2. 确保Profile窗口已打开
3. 确认 `save.png` 和 `next.png` 已准备好
4. **重要：手动切换到起始帧**（例如，如果设置StartFrame为1，请先切换到第1帧）
5. 双击运行 `FLIR_AutoSave.ahk`
6. 在弹出的确认对话框中点击"是"
7. 等待5秒准备时间
8. 脚本会自动开始批量导出
9. 可以随时按 `ESC` 键中止

## 操作原理

脚本会自动重复以下操作步骤：

1. **图像识别查找Save按钮** - 在全屏范围内查找save.png图像并点击
2. **使用快捷键操作保存对话框**：
   - `Alt+T` - 切换到文件类型下拉框
   - `↓` + `Enter` - 选择CSV格式
   - `Alt+N` - 切换到文件名输入框
   - 输入 "Frame_[帧号]"
   - `Alt+S` - 点击保存按钮
3. **等待文件保存完成**
4. **图像识别查找下一帧箭头** - 查找next.png图像并点击
5. 重复以上步骤直到所有帧都保存完成

**v2.0 优势**：
- 图像识别：自动适应不同窗口位置和分辨率
- 快捷键操作：比鼠标点击坐标更稳定可靠
- 无需配置：只需截取两张图片即可使用

## 快捷键说明

### FLIR_AutoSave.ahk（主脚本）
- `ESC` - 中止批量导出
- `F1` - 显示帮助信息

### ImageCapture.ahk（图像截取工具）
- `Ctrl+1` - 查看save.png截取说明
- `Ctrl+2` - 查看next.png截取说明
- `ESC` - 退出程序

### CoordinateFinder.ahk（v1.x旧版工具，v2.0不再需要）
- `Ctrl+Shift+C` - 保存当前鼠标位置坐标
- `F1` - 查看所有已保存坐标并复制代码
- `F2` - 清除所有已保存坐标
- `F3` - 显示帮助信息
- `ESC` - 退出程序

## 常见问题

### 1. 图像识别失败，找不到按钮？
- **检查图像文件**：确保save.png和next.png文件存在于脚本目录
- **重新截取图像**：使用更清晰、更精确的截图
- **调整识别容差**：在脚本中增大ImageTolerance值（如改为50或100）
- **检查按钮状态**：截图时确保按钮处于正常状态（未被高亮或按下）
- **检查窗口可见性**：确保按钮完全可见，未被其他窗口遮挡

### 2. 保存对话框快捷键不起作用？
- **验证快捷键**：不同版本的Windows或FLIR软件快捷键可能不同
- **手动测试**：打开保存对话框，手动按Alt+T、Alt+N、Alt+S测试是否有效
- **修改脚本**：如果快捷键不同，可以在脚本中修改对应的Send命令
- **使用Tab键**：可以尝试用Tab键导航代替Alt快捷键

### 3. 脚本运行后没有反应？
- 检查AutoHotkey是否正确安装
- 确保FLIR软件和Profile窗口已打开
- 检查save.png和next.png文件是否存在
- 查看是否有错误提示对话框

### 4. 文件没有保存到指定位置？
- 检查SavePath路径是否正确
- 确保该路径存在且有写入权限
- 检查路径中是否使用了正确的反斜杠（Windows使用反斜杠\）

### 5. 保存速度太快或太慢？
- 可以调整脚本中的延迟参数：
  ```ahk
  DelayShort := 300        ; 短延迟（界面响应）
  DelayMedium := 800       ; 中等延迟（对话框打开）
  DelayLong := 1500        ; 长延迟（文件保存）
  ```

### 6. 某些帧保存失败？
- 增加延迟时间，给软件更多响应时间
- 检查磁盘空间是否充足
- 检查帧号是否在有效范围内
- 查看是否有错误提示，脚本会询问是否继续

### 7. 如何获取更好的截图？
- 使用Windows自带的截图工具（Win+Shift+S）
- 截图时只包含按钮本身，不要包含过多背景
- 确保截图清晰，不要模糊
- 图像大小建议30-80像素
- 截图时按钮应处于正常状态（未激活）

## 注意事项

1. **必须准备图像文件**：运行前确保save.png和next.png存在于脚本目录
2. **运行前必须手动切换到起始帧**：脚本会从当前帧开始，通过点击右箭头逐帧导出
3. **运行期间请勿移动鼠标或操作电脑**：否则可能干扰脚本执行
4. **首次使用前务必先测试**：建议先设置小范围（如1-5帧）测试是否正常
5. **图像质量很重要**：截图要清晰，只包含按钮本身
6. **备份重要数据**：虽然脚本不会修改原始数据，但建议做好备份
7. **确保帧范围正确**：如果当前帧号加上要导出的帧数超过视频总帧数，可能会导致错误
8. **窗口不要最小化**：确保FLIR窗口和按钮可见
9. **测试快捷键**：首次使用前手动测试保存对话框的快捷键是否有效

## 技术支持

如有问题或建议，请在GitHub上提交Issue。

## 许可证

本项目采用MIT许可证，可自由使用和修改。

## 更新日志

### v2.0 (2025-11-17)
- **重大更新**：使用图像识别技术，无需手动配置坐标
- **新增**：使用快捷键操作保存对话框，更稳定可靠
- **新增**：ImageCapture.ahk图像截取辅助工具
- **改进**：自动适应不同分辨率和窗口位置
- **简化**：只需截取两张按钮图片即可使用
- **优化**：添加图像文件检查和详细错误提示
- **优化**：改进的错误处理，识别失败时询问是否继续

### v1.1 (2025-11-17)
- 改进：使用右箭头按钮切换帧，替代输入帧号的方式
- 简化了操作流程，提高了稳定性
- 用户需要在运行前手动切换到起始帧
- 更新了使用说明和操作原理

### v1.0 (2025-11-17)
- 初始版本发布
- 支持批量导出帧数据为CSV格式
- 包含坐标获取辅助工具（CoordinateFinder.ahk）